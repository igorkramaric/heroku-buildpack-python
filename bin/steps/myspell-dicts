#!/usr/bin/env bash

# This script copies MySpell dictionaries to site-packages/echant

# The location of the pre-compiled enchant library.
MY_SPELL_DICTS_PATH="https://analytics-p-junk.s3.amazonaws.com/myspell.zip"
A_SPELL_DICTS_PATH="https://analytics-p-junk.s3.amazonaws.com/aspell-dicts.zip"

TARGET_DIR_ENCHANT_DICTS="/app/.heroku/python/lib/python2.7/site-packages/enchant/share/enchant/myspell"
TARGET_DIR_ASPELL_DICTS="/app/.heroku/vendor/lib/aspell-0.60"

# If enchant exists within requirements, use vendored enchant.
if ((grep -Fiq "enchant" $BUILD_DIR/requirements.txt) || (grep -Fiq "enchant" $BUILD_DIR/setup.py)) then

  echo "-----> Noticed enchant. Copying MySpell dictionaries."
  mkdir -p $TARGET_DIR_ENCHANT_DICTS

  pushd $TARGET_DIR_ENCHANT_DICTS

  # Download and extract dicts.
  curl -s -L -o myspell-dicts.zip $MY_SPELL_DICTS_PATH
  unzip -j -o myspell-dicts.zip

  rm myspell-dicts.zip

  chmod 644 *
  ls -al

  popd
 
  echo "-----> Copying Aspell dictionaries."

  ls -al /app/.heroku
  mkdir -p $TARGET_DIR_ASPELL_DICTS

  pushd $TARGET_DIR_ASPELL_DICTS

  # Download and extract dicts.
  curl -s -L -o aspell-dicts.zip $A_SPELL_DICTS_PATH
  unzip -j -o aspell-dicts.zip

  rm aspell-dicts.zip

  chmod 644 *
  ls -al

  popd
  echo "<----- Copied Aspell dictionaries."
fi